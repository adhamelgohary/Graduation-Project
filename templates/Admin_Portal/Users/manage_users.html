{% extends "Admin_Portal/base.html" %}

{% block title %}Manage Users{% endblock %}

{% block nav_users %}active{% endblock %}

{% block header_title %}<i class="fas fa-users-cog"></i> Manage Users{% endblock %}

{% block extra_css %}
<style>
    .user-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }
    .stat-card {
        background-color: #f4f4f4;
        border-radius: 8px;
        padding: 15px;
        text-align: center;
    }
    .filter-section {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: left;
    }
    th {
        background-color: #f2f2f2;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="user-stats-grid">
        <div class="stat-card">
            <h3>Total Users</h3>
            <p>{{ user_stats.total_users }}</p>
        </div>
        <div class="stat-card">
            <h3>Admins</h3>
            <p>{{ user_stats.admin_count }}</p>
        </div>
        <div class="stat-card">
            <h3>Doctors</h3>
            <p>{{ user_stats.doctor_count }}</p>
        </div>
        <div class="stat-card">
            <h3>Patients</h3>
            <p>{{ user_stats.patient_count }}</p>
        </div>
    </div>

    <form method="GET" class="filter-section">
        <select name="user_type">
            <option value="all" {% if filter_user_type == 'all' %}selected{% endif %}>All User Types</option>
            <option value="admin" {% if filter_user_type == 'admin' %}selected{% endif %}>Admins</option>
            <option value="doctor" {% if filter_user_type == 'doctor' %}selected{% endif %}>Doctors</option>
            <option value="patient" {% if filter_user_type == 'patient' %}selected{% endif %}>Patients</option>
        </select>

        <select name="status">
            <option value="all" {% if filter_status == 'all' %}selected{% endif %}>All Statuses</option>
            <option value="active" {% if filter_status == 'active' %}selected{% endif %}>Active</option>
            <option value="inactive" {% if filter_status == 'inactive' %}selected{% endif %}>Inactive</option>
            <option value="suspended" {% if filter_status == 'suspended' %}selected{% endif %}>Suspended</option>
            <option value="pending" {% if filter_status == 'pending' %}selected{% endif %}>Pending</option>
        </select>

        <input type="text" name="search" placeholder="Search users..." value="{{ search_query }}">
        <button type="submit" class="btn btn-primary">Filter</button>
        <a href="{{ url_for('admin_users.add_user') }}" class="btn btn-success">Add New User</a>
    </form>

    <table>
        <thead>
            <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Name</th>
                <th>User Type</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.username }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.first_name }} {{ user.last_name }}</td>
                <td>{{ user.user_type|capitalize }}</td>
                <td>{{ user.account_status|capitalize }}</td>
                <td>
                    <a href="{{ url_for('admin_users.view_user', user_id=user.user_id) }}" class="btn btn-sm btn-info">View</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}