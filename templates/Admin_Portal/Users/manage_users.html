{% extends "Admin_Portal/base.html" %}

{% block title %}Manage Users{% endblock %}

{% block nav_users %}active{% endblock %}

{% block header_title %}<i class="fas fa-users-cog"></i> Manage Users{% endblock %}

{% block content %}
<div class="container List-container">
    <div class="stats-summary user-stats-grid">
        <div class="stat-card">
            <div class="stat-value">{{ user_stats.total_users }}</div>
            <div class="stat-label">Total Users</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ user_stats.admin_count }}</div>
            <div class="stat-label">Admins</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ user_stats.doctor_count }}</div>
            <div class="stat-label">Doctors</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ user_stats.patient_count }}</div>
            <div class="stat-label">Patients</div>
        </div>
    </div>

    <div class="search-add-container">
        <form method="GET" class="search-container">
            <select name="user_type" class="filter-group">
                <option value="all" {% if filter_user_type == 'all' %}selected{% endif %}>All User Types</option>
                <option value="admin" {% if filter_user_type == 'admin' %}selected{% endif %}>Admins</option>
                <option value="doctor" {% if filter_user_type == 'doctor' %}selected{% endif %}>Doctors</option>
                <option value="patient" {% if filter_user_type == 'patient' %}selected{% endif %}>Patients</option>
            </select>

            <select name="status" class="filter-group">
                <option value="all" {% if filter_status == 'all' %}selected{% endif %}>All Statuses</option>
                <option value="active" {% if filter_status == 'active' %}selected{% endif %}>Active</option>
                <option value="inactive" {% if filter_status == 'inactive' %}selected{% endif %}>Inactive</option>
                <option value="suspended" {% if filter_status == 'suspended' %}selected{% endif %}>Suspended</option>
                <option value="pending" {% if filter_status == 'pending' %}selected{% endif %}>Pending</option>
            </select>

            <input type="text" name="search" placeholder="Search users..." value="{{ search_query }}" class="search-input">
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Filter</button>
                <a href="{{ url_for('admin_users.add_user') }}" class="btn btn-success">Add New User</a>
            </div>
        </form>
    </div>

    <table class="List-table data-table">
        <thead>
            <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Name</th>
                <th>User Type</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.username }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.first_name }} {{ user.last_name }}</td>
                <td>{{ user.user_type|capitalize }}</td>
                <td>
                    <span class="status-badge {% if user.account_status == 'active' %}status-confirmed{% elif user.account_status == 'inactive' %}status-canceled{% elif user.account_status == 'pending' %}status-scheduled{% endif %}">
                        {{ user.account_status|capitalize }}
                    </span>
                </td>
                <td class="actions">
                    <a href="{{ url_for('admin_users.view_user', user_id=user.user_id) }}" class="btn-icon view">
                        <i class="fas fa-eye"></i>
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if users|length == 0 %}
    <div class="no-results">
        <p>No users found matching the current filters.</p>
    </div>
    {% endif %}
</div>
{% endblock %}