{% extends "Doctor_Portal/base.html" %}
{% block title %}Create Appointment{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Create New Appointment</h1>
    <a href="{{ url_for('.list_appointments') }}" class="button button-outline button-secondary">
        <i class="fas fa-arrow-left fa-fw"></i> Back to List
    </a>
</div>

{# Display form errors #}
{% if errors %}
<div class="alert alert-danger"> {# Use base.css alert class #}
    <strong>Please correct the errors:</strong>
    <ul>
        {% for error in errors %}<li>{{ error }}</li>{% endfor %}
    </ul>
</div>
{% endif %}

<div class="card">
    <div class="card-body">
        <form action="{{ url_for('.create_appointment') }}" method="post">
             {# Use basic grid or simple divs #}
             <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-md);">
                <div>
                    <label for="patient_id" class="form-label">Patient</label>
                    <select class="form-select" id="patient_id" name="patient_id" required>
                        <option value="">Select Patient...</option>
                        {% for patient in patients %}<option value="{{ patient.user_id }}" {% if form_data and form_data.patient_id|int == patient.user_id %}selected{% endif %}>{{ patient.name }}</option>{% endfor %}
                    </select>
                </div>
                <div>
                    <label class="form-label">Provider</label>
                    <input type="text" class="form-control" value="{{ doctors[0].name }}" disabled>
                    <input type="hidden" name="doctor_id" value="{{ doctors[0].user_id }}">
                </div>
                <div>
                    <label for="appointment_date" class="form-label">Date</label>
                    <input type="date" class="form-control" id="appointment_date" name="appointment_date" value="{{ form_data.appointment_date if form_data else '' }}" required min="{{ today_iso }}"> {# Use Jinja's now() #}
                </div>
                <div>
                    <label for="start_time" class="form-label">Start Time</label>
                    <input type="time" class="form-control" id="start_time" name="start_time" value="{{ form_data.start_time if form_data else '' }}" required step="900"> {# 15min increments #}
                </div>
                <div>
                    <label for="appointment_type" class="form-label">Appointment Type</label>
                    <select class="form-select" id="appointment_type" name="appointment_type" required>
                        <option value="">Select Type...</option>
                        {% for type in appointment_types %}<option value="{{ type }}" {% if form_data and form_data.appointment_type == type %}selected{% endif %}>{{ type|capitalize }}</option>{% endfor %}
                    </select>
                </div>
                 <div>
                     <label for="location_id" class="form-label">Location</label>
                     <select class="form-select" id="location_id" name="location_id" required {% if not locations %}disabled{% endif %}>
                         <option value="">Select Location...</option>
                         {% for loc in locations %}<option value="{{ loc.location_id }}" {% if form_data and form_data.location_id|int == loc.location_id %}selected{% endif %}>{{ loc.name }}</option>{% endfor %}
                     </select>
                     {% if not locations %}<small class="text-danger d-block mt-1">No locations available.</small>{% endif %}
                </div>
                 {# Span full width for text inputs #}
                 <div style="grid-column: 1 / -1;">
                    <label for="reason" class="form-label">Reason for Visit (Optional)</label>
                    <input type="text" class="form-control" id="reason" name="reason" value="{{ form_data.reason if form_data else '' }}">
                </div>
                 <div style="grid-column: 1 / -1;">
                    <label for="notes" class="form-label">Provider Notes (Optional)</label>
                    <textarea class="form-control" id="notes" name="notes" rows="3">{{ form_data.notes if form_data else '' }}</textarea>
                </div>
             </div>
            <button type="submit" class="button button-success mt-4" {% if not locations %}disabled{% endif %}>
                 <i class="fas fa-check fa-fw"></i> Create Appointment
             </button>
        </form>
    </div>
</div>
{% endblock %}