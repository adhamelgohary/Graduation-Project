{% extends "Doctor_Portal/base.html" %} {# Assumes nutritionist uses same base #}
{% block title %}Diet Plans{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Diet Plan Management</h1>
    <a href="{{ url_for('diet_plans.add_diet_plan') }}" class="button button-primary"><i class="fas fa-plus"></i> Add New Plan</a>
</div>

{# Add Search/Filter Form here (similar to disease_list.html) #}
<form method="GET" action="{{ url_for('diet_plans.list_diet_plans') }}" class="search-form card card-body mb-4">
    {# Inputs for search, filter_type, filter_public #}
    {# Submit button #}
</form>

<div class="card shadow-sm">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
                <thead>
                    <tr>
                        {# Add sortable headers using macro like in disease_list.html #}
                        <th>ID</th>
                        <th>Plan Name</th>
                        <th>Type</th>
                        <th>Calories</th>
                        <th>Creator</th>
                        <th>Public</th>
                        <th>Last Updated</th>
                        <th class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for plan in plans %}
                    <tr>
                        <td>{{ plan.plan_id }}</td>
                        <td><a href="{{ url_for('.view_diet_plan', plan_id=plan.plan_id) }}"><strong>{{ plan.plan_name }}</strong></a></td>
                        <td>{{ plan.plan_type | title }}</td>
                        <td>{{ plan.calories | default('N/A') }}</td>
                        <td>
                            {% if plan.creator_user_id %}
                                {{ plan.creator_first_name }} {{ plan.creator_last_name }}
                            {% else %}
                                <span class="text-muted">System</span>
                            {% endif %}
                        </td>
                        <td>{% if plan.is_public %}<i class="fas fa-check-circle text-success"></i>{% else %}<i class="fas fa-times-circle text-muted"></i>{% endif %}</td>
                        <td>{{ plan.updated_at.strftime('%Y-%m-%d %H:%M') if plan.updated_at else 'N/A' }}</td>
                        <td class="action-buttons text-end">
                            <a href="{{ url_for('.view_diet_plan', plan_id=plan.plan_id) }}" class="button button-outline button-small" title="View"><i class="fas fa-eye"></i></a>
                            {% if plan.is_public or plan.creator_id == current_user.user_id %} {# Edit Auth Check #}
                            <a href="{{ url_for('.edit_diet_plan', plan_id=plan.plan_id) }}" class="button button-outline button-secondary button-small" title="Edit"><i class="fas fa-edit"></i></a>
                            {% endif %}
                            {% if plan.is_public or plan.creator_id == current_user.user_id %} {# Delete Auth Check #}
                            <form action="{{ url_for('.delete_diet_plan', plan_id=plan.plan_id) }}" method="POST" class="d-inline" onsubmit="return confirm('Delete plan \'{{ plan.plan_name|e }}\'? This cannot be undone.');">
                                <button type="submit" class="button button-outline button-danger button-small" title="Delete"><i class="fas fa-trash"></i></button>
                            </form>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="8" class="text-center text-muted">No diet plans found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
     {# Add Pagination Controls here (similar to disease_list.html) #}
</div>
{% endblock %}